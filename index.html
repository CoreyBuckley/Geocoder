<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<link href="style.css" rel="stylesheet">
		<title>Google Map JS API</title>
	</head>
	<body>
		<h2 class="center">Google Maps API</h2>
		<p class="center">Generated by Google's JS API</p>
		<div id="map"></div>
		<form id="location">
			<label>Street Address</label>
			<input id="street" name="street address" type="text" required/>
			<label>City</label>
			<input id="city" name="city" type="text" required/>
			<label>State</label>
			<input id="state" name="state" type="text" required/> 
			<input id="submit" type="button" value="Geocode" onclick="geocode()"/>
		</form>
		<p id="output">

		</p>
	</body>
	<script>
		var map;
		var geocoder;
		var position;
		if (navigator.geolocation) { //if the browser supports geolocation
			position = navigator.geolocation.getCurrentPosition(initMap); //get the current location
			//getCurrentPosition takes two callback functions and an options variable
			//getCurrentPosition(success,error,options)
			//it will pass the position to the success function and the error to the error callback
			//only the success callback is required
		}
		function initMap(position) {
			var latlng = {lat: position.coords.latitude, lng: position.coords.longitude};
			map = new google.maps.Map(document.getElementById("map"),
			{
				center: latlng,
				zoom: 15,
				mapTypeId: google.maps.MapTypeId.SATELLITE
			});
			geocoder = new google.maps.Geocoder();
			reverseGeocode(latlng);
			google.maps.event.addListener(map,"click",function(event) {
				reverseGeocode(event.latLng);
			});
		}	
		function geocode() {
			var locationParts = [document.getElementById("street").value, 
								 document.getElementById("city").value, 
								 document.getElementById("state").value];
			var address = locationParts.join();
			var marker;
			var infowindow;
			geocoder.geocode({"address":address}, function(results, status) {
				if (status == "OK") {
					map.setCenter(results[0].geometry.location);
					marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location
					});
					var output = document.getElementById("output");
					var latlng = results[0].geometry.location;
					output.innerHTML = "Latitude: " + latlng.lat() + " Longitude: " + latlng.lng();
					infowindow = new google.maps.InfoWindow({
						content: "<p>Marker Location: " + marker.getPosition() + "</p>"
					});
					google.maps.event.addListener(marker,"click",function() {
						infowindow.open(map, marker);
					});
				}
				else {
					alert("Geocode not successful because: " + status);
				}
			});
		}
		function reverseGeocode(latlng) {
			// if (!(latlng instanceof {}.constructor)) {
			// 	this.latlng = latlng.latLng;
			// }
			geocoder.geocode({"location":latlng}, function(results, status) {
				if (status == "OK") {
					var locationParts = [document.getElementById("street"), 
										 document.getElementById("city"), 
										 document.getElementById("state")];
					var addressComp = results[0].address_components;
					for (var i = 0; i < addressComp.length; i++) {
						console.log(addressComp[i].types[0]);
						if (addressComp[i].types[0] == "street_number") {
							locationParts[0].value = addressComp[i].long_name;
						}
						else if (addressComp[i].types[0] == "route") {
							locationParts[0].value += " " + addressComp[i].long_name;
						}
						else if (addressComp[i].types[0] == "locality") {
							locationParts[1].value = addressComp[i].long_name;
						}
						else if (addressComp[i].types[0] == "administrative_area_level_1") {
							locationParts[2].value = addressComp[i].short_name;
						}
					}									
					console.log(results[0].address_components);
				}
				else {
					alert("Geocode not successful because: " + status);
				}
			});
		}
	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyChL93HONJbMsS98vBNjaGnOYr3ieQnag0&callback=initMap">
	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/geocode/json?address=&key=AIzaSyBu1QeHuNrMZn6KjG1PQ-kmRjkCQbbKSu4">

</html>